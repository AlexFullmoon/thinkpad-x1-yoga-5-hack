# ACPI files

All files are provided in decompiled form with comments, remember to compile them before use (Save as.. → ACPI Machine Language).

## SSDT-PLUG

Adds PluginType for CPU power management. Pretty much a default one, you can grab sample from Dortania and edit as described there.

CPU ACPI location is `_SB_.PR00`.

## SSDT-USBX

USB power properties injection. Default one. Usually paired with EC patch, but EC device in this laptop is present and correct, so patch is not required.

## SSDT-PNLF

Backlight enabler for WEG. GPU location is `_SB_.PCI0.GFX0`. Using drop-in file from WEG.

The one generated by SSDTTime is smaller, but for some reason requires ACPI patch. This warrants some further testing.

## SSDT-RTCAWAC

RTC fix. Default one, you can get it either from Dortania or generate with SSDTTime. 

## SSDT-RHUB  

USB hub fix. Device location is `_SB_.PCI0.XHC.RHUB`. Default one from Dortania or SSDTTime.

## SSDT-OSI

OS variables. For I2C trackpad and YogaSMC functionality. Usually you would use a standard XOSI, but we also need to set additional variable, and for some reason XOSI doesn't play nice with YogaSMC. 

## SSDT-FIXDEV   

Recommended fixes for some devices: AC adapter, fake ambient light sensor, power button and DMA controller. See file content for more details.

## SSDT‑HPET

IRQ patches for legacy devices. Traditional stuff, might not be necessary nowadays.

## SSDT-TB

One big thunderbolt patch. I honestly have no idea what it does.

Currently controller appear in system, and display connection over Thunderbolt/DisplayPort works for both ports. As I have no other Thunderbolt devices, this is all I can and would do. Feel free to PR corrections.

## SSDT-YOGA

Collection of supplementary patches for YogaSMC, mainly providing RW interface to kext.

## SSDT-KEYMAP

Remapping several keys, configuration for VoodooPS2Keyboard. See details in [docs/Input.md](Input.md).

## SSDT-EXTRAS

Adding a bunch of missing devices to IORegistry, most likely there are only cosmetic fixes and don't do anything significant.

- MCHC — Host Bridge/DRAM Registers, part of older SMBus patch stuff. Supposedly not necessary nowadays.
- PGMM — Core Processor Gaussian Mixture Model. Something something speech recognition co-processor?
- BUS0 — Missing SMBus device. Supposedly not necessary nowadays.
- PMCR — Comet Lake Thermal Controller.
- SRAM — Comet Lake Shared SRAM.
- XSPI — Comet Lake SPI controller.

## DMAR

Replacement DMA Regions table with Protected regions removed. **Requires DMAC device from SSDT-FIXDEV.**

⚠️ Not provided. **Make your own**, with SSDTTime, for example. This table *may be* specific to BIOS version. If using it, you **have to drop original** DMAR table.

Choose between using it, using DisableIOMapper quirk, or disabling VT-d in BIOS. Latter variant is preferred if you don't need it for other OSes, e.g. for running VMs.

Which way (quirk or DMAR) is preferable is unclear. OpenCore manual recommends quirk, but there are reports that cleaned DMAR table is better in some cases.

# Some theory

## OSI

So, for *arcane* reasons certain functionality, most notably touchpad stuff, is disabled or enabled in ACPI depending on which OS version you run. To enable everything, we need to set several flag variables that would mean you are running certain OS — specifically, we need `WNTF` (Windows 2000+), `WIN8` (Windows 8+) and `LNUX` (Linux, duh), as well as assign specific value to `OSYS` (the one for Windows 10). OS version is read with `_OSI` method, Operating System Interface.

A common way to deal with this is `XOSI` method (along with rename patch). Patch replaces all calls of `_OSI` in DSDT, of which most are in `\SB.PCI0._INI`, calling `XOSI` instead. `XOSI` returns true for all specified OS versions, and this results in setting all those variables.

In this case we instead set those variables directly.

## DTGP

(information from somewhere on reddit)

DTGP is a method that passes through calls to `_DSM` methods on various Device objects, unless a specific UUID is provided that indicates macOS is the OS calling the `_DSM` method. macOS has non standard device enumeration behavior. Specifically, macOS first probes each ACPI Device's DSM by passing only 2 arguments (one of which is the UUID). macOS then expects (as real macs behave this way) that the `_DSM` method will return the number of additional arguments that can be used with it's `_DSM` method. It's fine if the device says more arguments than expected, but not less, so its best to just return the maximum, which is 3...

The fact is that `DTGP` method is present in all real Mac's DSDT I have seen. I would say it's added by Apple to handle Windows (under BootCamp).
